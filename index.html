<!DOCTYPE html>
<html lang="tg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinyin Reader TJ - Омӯзиши чинӣ мисли Duolingo</title>
    <script src="https://cdn.jsdelivr.net/npm/pinyin-pro@3.20.0/dist/index.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f0f8ff; margin: 0; }
        h1, h2 { color: #006400; }
        #profile { font-size: 18px; margin: 15px 0; padding: 10px; background: #e8f5e9; border-radius: 8px; }
        textarea { width: 90%; max-width: 700px; height: 120px; padding: 12px; font-size: 20px; margin: 15px auto; display: block; border: 2px solid #ccc; border-radius: 8px; }
        button { padding: 12px 30px; font-size: 17px; margin: 10px; cursor: pointer; border: none; border-radius: 8px; color: white; }
        #convertBtn { background: #4CAF50; }
        #clearBtn { background: #f44336; }
        #output { font-size: 28px; margin: 25px 0; min-height: 80px; line-height: 1.6; }
        .lesson { background: #ffffff; border: 1px solid #ddd; padding: 15px; margin: 12px auto; max-width: 700px; border-radius: 8px; cursor: pointer; font-size: 18px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .lesson:hover { background: #f1f8e9; }
        .quiz { display: none; margin: 20px auto; max-width: 700px; }
        .option { background: #e3f2fd; padding: 12px; margin: 8px auto; border-radius: 6px; cursor: pointer; font-size: 17px; max-width: 500px; }
        .option:hover { background: #bbdefb; }
        #error { color: #d32f2f; font-weight: bold; margin: 15px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Омӯзиши чинӣ мисли Duolingo</h1>
    
    <div id="profile">
        Нуқтаҳо: <span id="xp">0</span>  |  
        Сатҳ: <span id="level">1</span>  |  
        Стрик: <span id="streak">0</span> рӯз  |  
        Дилҳо: <span id="hearts">5</span> ❤️
    </div>

    <h2>Дарсҳоро интихоб кунед</h2>
    <div class="lesson" onclick="startLesson(0)">Дарси 1: Саломгуӣ ва ибтидо</div>
    <div class="lesson" onclick="startLesson(1)">Дарси 2: Оила ва дӯстон</div>
    <!-- Метавонӣ дарсҳои нав илова кунӣ -->

    <div class="quiz" id="quiz">
        <h2 id="question"></h2>
        <div id="options"></div>
        <button onclick="nextQuestion()">Навбатӣ →</button>
    </div>

    <div id="output"></div>
    <div id="error"></div>

    <script>
        // Маълумот барои дарсҳо
        const lessons = [
            { // Дарси 1
                title: "Саломгуӣ",
                questions: [
                    { chinese: "你好", pinyin: "nǐ hǎo", question: "Чӣ тавр \"Салом\" мегӯянд?", options: ["zài jiàn", "nǐ hǎo", "xiè xiè"], correct: 1 },
                    { chinese: "谢谢", pinyin: "xiè xiè", question: "Чӣ тавр \"Раҳмат\" мегӯянд?", options: ["xiè xiè", "duì bù qǐ", "nǐ hǎo"], correct: 0 },
                    { chinese: "再见", pinyin: "zài jiàn", question: "Чӣ тавр \"Хайр\" мегӯянд?", options: ["nǐ hǎo", "zài jiàn", "wǒ ài nǐ"], correct: 1 }
                ]
            },
            { // Дарси 2
                title: "Оила",
                questions: [
                    { chinese: "家庭", pinyin: "jiā tíng", question: "Чӣ тавр \"Оила\" мегӯянд?", options: ["péng you", "jiā tíng", "xué xiào"], correct: 1 },
                    { chinese: "妈妈", pinyin: "mā ma", question: "Чӣ тавр \"Модар\" мегӯянд?", options: ["bà ba", "mā ma", "gē ge"], correct: 1 },
                    { chinese: "爸爸", pinyin: "bà ba", question: "Чӣ тавр \"Падар\" мегӯянд?", options: ["bà ba", "jiě jie", "dì di"], correct: 0 }
                ]
            }
        ];

        let currentLesson = -1;
        let currentQuestion = 0;
        let xp = parseInt(localStorage.getItem('pinyin_xp') || '0');
        let streak = parseInt(localStorage.getItem('pinyin_streak') || '0');
        let hearts = 5;
        let lastPractice = localStorage.getItem('pinyin_last') || '';

        const today = new Date().toDateString();

        if (lastPractice !== today) {
            streak = lastPractice === new Date(Date.now() - 86400000).toDateString() ? streak + 1 : 1;
            localStorage.setItem('pinyin_streak', streak);
            localStorage.setItem('pinyin_last', today);
        }

        function updateProfile() {
            document.getElementById('xp').textContent = xp;
            document.getElementById('level').textContent = Math.floor(xp / 100) + 1;
            document.getElementById('streak').textContent = streak;
            document.getElementById('hearts').textContent = hearts;
            localStorage.setItem('pinyin_xp', xp);
        }

        function startLesson(idx) {
            currentLesson = idx;
            currentQuestion = 0;
            hearts = 5;
            document.getElementById('quiz').style.display = 'block';
            document.getElementById('error').textContent = '';
            showQuestion();
            updateProfile();
        }

        function showQuestion() {
            const qData = lessons[currentLesson].questions[currentQuestion];
            if (!qData || hearts <= 0) {
                endLesson();
                return;
            }

            document.getElementById('question').textContent = qData.question + "  (" + qData.chinese + ")";
            let html = '';
            qData.options.forEach((opt, i) => {
                html += `<div class="option" onclick="checkAnswer(\( {i})"> \){opt}</div>`;
            });
            document.getElementById('options').innerHTML = html;
        }

        function checkAnswer(selected) {
            const correctIdx = lessons[currentLesson].questions[currentQuestion].correct;
            if (selected === correctIdx) {
                xp += 10;
                document.getElementById('error').textContent = 'Афарин! ✓';
            } else {
                hearts--;
                document.getElementById('error').textContent = 'Нодуруст ✗  Дуруст: ' + lessons[currentLesson].questions[currentQuestion].pinyin;
            }
            updateProfile();
            currentQuestion++;
            showQuestion();
        }

        function endLesson() {
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('output').innerHTML = hearts > 0 
                ? `<strong>Дарс анҷом ёфт! +${xp % 10 === 0 ? 10 : ''} нуқта</strong>` 
                : '<strong>Дилҳо тамом шуд. Кӯшиш кунед дубора!</strong>';
            updateProfile();
        }

        function nextQuestion() {
            currentQuestion++;
            showQuestion();
        }

        updateProfile(); // аввал бор нишон медиҳад
    </script>
</body>
</html>
